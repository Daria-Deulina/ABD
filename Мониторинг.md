Мониторинг
PostgreSQL работает под управлением операционной системы и в известной степени зависит от ее настроек. Unix предоставляет множество инструментов для анализа состояния и производительности.
Статистика внутри базы
Я создала базу данных и таблицу
![alt-текст](https://psv4.userapi.com/c237331/u206680720/docs/d2/0901e85b7111/68747470733a2f2f73756e392d33352e757365726170692e636f6d2f696d70672f49354e6274356d544e736e546131386d5a6c646871766d51376a334d455665486c3854334b672f3057313669746437354d382e6a70673f73697a653d37303478343034267175616c697.jpg?extra=S6pf_7z-DAIDeTzn9TlIkvdiAAU_4vmiMwqfDS4g6n4ditQ4mi_SvddNcyIVBfV6D9GEmu2a83nBCpb9UybN-NjjIXUSxBg58w3FY-HDjQ1YvtMXVet47TJgOhMzR9a6VH7K9WOKNn9HwIWmDBH3YpdMt0cI "Текст заголовка логотипа 1")
Из статистики следует, что было вставлено 1000 строк, удалено 1000 строк. После этого активных версий строк не осталось.
Я выполнила очистку и снова проверила статистику
![alt-текст](https://psv4.userapi.com/c237231/u206680720/docs/d7/87f8d8be64ae/68747470733a2f2f73756e392d38302e757365726170692e636f6d2f696d70672f39323254334b69544b664c4c386e4d6d516545745858443950445944444463743359556d55672f476a45486d70365979544d2e6a70673f73697a653d37343078343035267175616c697.jpg?extra=ekizDJ-in9GmXdgrd8H4kUHZE1EC-2KaXaBLkiD3wN3BusoQwg6qHlOLglJdFiY4BCzboWuRGovsqkEI8qZ_FwfDilh2lvOGYPkocbrrhXBVamxobbCGeMcwn4rQpAuYA2YUxrXOlHd2C8MDIqJEr3FOCSsI "Текст заголовка логотипа 1")
Неактуальные версии строк убраны при очистке, очистка обрабатывала таблицу один раз (vacuum_count = 1)
Взаимоблокировка Создала ситуацию взаимоблокировк двух транзакций
 Одна транзакция блокирует первую строку таблицыи
![alt-текст](https://psv4.userapi.com/c237031/u206680720/docs/d59/55fc823801ad/68747470733a2f2f73756e392d34302e757365726170692e636f6d2f696d70672f766e626d4550315a437733786866353138473441797a61494b5031456a543266353069392d512f6a6a78586e614a323751632e6a70673f73697a653d343434783935267175616c69747.jpg?extra=UXF6TQjHk277W0VuU04xBI9jLrD2cpaO0_XqTzc2jtUF3LTC8CXRa57vv1kX0qTFYJn4zh8OQj4Y-CLYq4sIR5KHJYmqZEWGDBdnl6W7XHsZjuKz6-G5QEd_fICibpEp8DVS0BXxP9cUDcfTai69yzQWAqcsI "Текст заголовка логотипа 1")
Другая транзакция блокирует вторую строку 
![alt-текст](https://psv4.userapi.com/c236331/u206680720/docs/d28/68489308f29e/68747470733a2f2f73756e392d38382e757365726170692e636f6d2f696d70672f444a624547777369514d3244665633673739694a4f74734b63624669505048504857495834512f4e6851537359716f704f492e6a70673f73697a653d34373578313135267175616c697.jpg?extra=zFxz07LVV9TnrXBX8pcncwFj4xtmZU2Vt9AzkfSaEzHw7UfoPMY0m3fL8G9HHeYtzXIyVKHvGVRB1yPCDfnpdZfSJ-K-kCQxJ74ZzChqQl1iEKrobLDl2ZLOVJimZbGE8OmtzsG3xcitP2At50CXk2uHG8MI "Текст заголовка логотипа 1")
Теперь первая транзакция пытается изменить вторую строку и ждет ее освобождения
![alt-текст](https://psv4.userapi.com/c237031/u206680720/docs/d29/9d69045158a7/68747470733a2f2f73756e392d37352e757365726170692e636f6d2f696d70672f6a626c3233375f6d6c6449565a622d587668355976572d3251304f63433832687754476f74412f4d734277713739776264452e6a70673f73697a653d343237783837267175616c69747.jpg?extra=JH86aM2HbjWZoDRsDLmwDEsScRzL38U60ujEqzDH_QPwnFNG5Wg9V1cQY0i4TABNQItbWiNVyQf6XDJnyz6iGSzvRqMQbBzCuD1b8rJkWBtlDxcpLjMV0IFPkSZS38-PJZgh6EWBnQEe0LRW8miEyebXdmAMI "Текст заголовка логотипа 1")
Расширение собирает статистику планирования и выполнения всех запросов. Для работы расширения требуется загрузить.Устанавливаем одноименный модул
Устанавливаем расширение и выполняем несколько запросов
![alt-текст](https://psv4.userapi.com/c235131/u206680720/docs/d42/0ae985dd5bc9/68747470733a2f2f73756e392d34302e757365726170692e636f6d2f696d70672f4e415750485161665a6562353871713665584545435f57596b596a70623.jpg?extra=g-PmiQPUSAGbxo71rBMHol-UIGtMfmCVUAC50dy1EBYhdptEAOfQ5xaD7uh3l1ydtW3D3bAS7HBWlhM5Y-mASUrSpqWu2iWCjPujDff2cdfaiVYOj_n_827cG6DS1gI5EMwtPNg_FntJLe3mZA5sVq7oVmUMI "Текст заголовка логотипа 1")
Затем посмотрела статистику запроса, который выполнялся чаще всего(INSERT INTO t VALUES)
![alt-текст](https://psv4.userapi.com/c237031/u206680720/docs/d34/9beb9bf4d986/68747470733a2f2f73756e392d33352e757365726170692e636f6d2f696d70672f49354e6274356d544e736e546131386d5a6c646871766d51376a334d455.jpg?extra=4dxSr7313X6AgUYoUN4v3SrKrQqrJT4VGvSFdNDuSDUail1NDMD7EWet2-JRmube88xOhS5tMQG5qjaI6iCTqBMSkgj-4C-luleNw7DdZVYI280r2VvpUFTOA9jfPgeO1fqj7pqVCMS5qfcLKN1ami2BvW8oVmUMI "Текст заголовка логотипа 1")
